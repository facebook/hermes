# Hermes Extensions

This directory contains JSI-based extensions that add functionality to the Hermes JavaScript runtime.

## Why JSI?

Extensions use [JSI (JavaScript Interface)](https://github.com/facebook/hermes/tree/main/API/jsi) rather than internal Hermes APIs. This provides:

- **Stability**: JSI is a stable public API. Extensions won't break when Hermes internals change.
- **Portability**: JSI works with any JSI-compatible runtime, not just Hermes.
- **Simplicity**: JSI is easier to use than internal VM APIs.

## Directory Structure

```
extensions/
├── 00-header.js          # IIFE wrapper (do not modify)
├── 99-footer.js          # IIFE wrapper (do not modify)
├── 20-Dummy.js           # Example core extension (JS)
├── Dummy.h/cpp           # Example core extension (C++)
├── Extensions.h/cpp      # Extension installation orchestration
├── Intrinsics.h/cpp      # Captures built-in constructors
├── ExtensionsBytecode.*  # Generated bytecode embedding
└── contrib/              # Community-contributed extensions
    └── README.md         # Contributor guidelines
```

## How Extensions Work

Each extension has two parts:

1. **JavaScript file** (`NN-ExtensionName.js`): Defines a setup function assigned to `extensions.ExtensionName`. The numeric prefix controls load order.

2. **C++ files** (`ExtensionName.h/cpp`): Calls the JS setup function, optionally passing native helper functions.

At runtime:
1. All JS files are concatenated and compiled to bytecode at build time
2. The bytecode is embedded in the binary and executed at startup
3. Each extension's C++ installer retrieves and calls its JS setup function

## Adding an Extension

### Core Extensions

Core extensions are maintained by the Hermes team. To add one:

1. Create `NN-ExtensionName.js` with your setup function
2. Create `ExtensionName.h` and `ExtensionName.cpp`
3. Add the C++ file to `EXTENSIONS_CPP_SOURCES` in `CMakeLists.txt`
4. Call your installer from `Extensions.cpp`

### Community Contributions

See [contrib/README.md](contrib/README.md) for guidelines on contributing extensions.

## Intrinsics

The `Intrinsics.h/cpp` files capture references to built-in constructors (like `TypeError`, `Uint8Array`) before any user code runs. Extensions should use these captured intrinsics rather than reading from globals, which users might have replaced.

```cpp
#include "Intrinsics.h"

// Use captured TypeError instead of global
throwTypeError(rt, "Expected a string");
```
