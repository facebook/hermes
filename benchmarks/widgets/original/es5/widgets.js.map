{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../context.js","webpack:///../widget.js","webpack:///../render_node.js","webpack:///../widgets.js","webpack:///../test_app_data.js","webpack:///../test_app.js","webpack:///../app_runner.js","webpack:///../index.js","webpack:///../main.js"],"names":["Context","key","childCounter","createForChild","parentCtx","child","widgetKey","childKey","undefined","constructor","name","newKey","Widget","_proto","prototype","reduce","ctx","Error","ComposedWidget","_Widget","_inheritsLoose","apply","arguments","_proto2","render","RenderNode","id","components","children","childrenEntities","flatMap","concat","create","idCounter","childCtx","Button","num","_this","call","component","x","Floater","_Widget2","_this2","Gltf","_Widget3","path","_this3","_proto3","Container","_Widget4","_this4","_proto4","map","SIZES_SMALL","SIZES_LARGE","slice","MODELS_SMALL","MODELS_LARGE","ButtonAndModel","_ComposedWidget","data","buttonSize","modelPath","Math","sqrt","TestApp","_ComposedWidget2","renderLarge","getWidgets","sizes","models","length","index","widget","getChildren","reconcileRenderNode","newNode","oldNode","reconcileChildren","newChildren","oldChildren","outChildren","oldChildrenByKey","Map","forEach","set","oldChild","get","push","mapEntitiesToComponents","entities","entity","value","diffTrees","newEntities","oldEntities","createdComponents","deletedComponents","oldEntityIds","newEntityIds","createdEntities","filter","entityId","includes","deletedEntities","oldComponents","newComponents","it","oldComponentsForKey","newComponentsForKey","deleted","created","runTest","includeTreeSerialization","oldCtx","oldWidgetTree","oldRenderTree","oldEntityTree","newCtx","newWidgetTree","newRenderTree","reconciledRenderTree","reconciledEntityTree","diff","globalThis","runFullTest","printDiff","print","JSON","stringify","i","t1","Date","now"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEgC;AAAA,IAEXA,OAAO;EAI1B,SAAAA,QAAYC,GAAW,EAAE;IAAA,KAHzBA,GAAG;IAAA,KACHC,YAAY;IAGV,IAAI,CAACD,GAAG,GAAGA,GAAG;IACd,IAAI,CAACC,YAAY,GAAG,CAAC;EACvB;EAACF,OAAA,CAEMG,cAAc,GAArB,SAAAA,eAAsBC,SAAkB,EAAEC,KAAa,EAAW;IAChE,MAAMC,SAAS,GAAGD,KAAK,CAACJ,GAAG;IAC3B,MAAMM,QAAQ,GACZD,SAAS,KAAK,IAAI,IAAIA,SAAS,KAAKE,SAAS,GACzCF,SAAS,GACR,GAAED,KAAK,CAACI,WAAW,CAACC,IAAK,IAAGN,SAAS,CAACF,YAAY,EAAG,EAAC;IAC7D,MAAMS,MAAM,GAAI,GAAEP,SAAS,CAACH,GAAI,IAAGM,QAAS,EAAC;IAC7C,OAAO,IAAIP,OAAO,CAACW,MAAM,CAAC;EAC5B,CAAC;EAAA,OAAAX,OAAA;AAAA;;;;;AC7BH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGmC;AAE5B,IAAMY,MAAM;EAAA,SAAAA,OAAA;IAAA,KACjBX,GAAG;EAAA;EAAA,IAAAY,MAAA,GAAAD,MAAA,CAAAE,SAAA;EAAAD,MAAA,CAEHE,MAAM,GAAN,SAAAA,OAAOC,GAAY,EAAc;IAC/B,MAAM,IAAIC,KAAK,CAAC,8BAA8B,CAAC;EACjD,CAAC;EAAA,OAAAL,MAAA;AAAA;AAGI,IAAMM,cAAc,0BAAAC,OAAA;EAAAC,cAAA,CAAAF,cAAA,EAAAC,OAAA;EAAA,SAAAD,eAAA;IAAA,OAAAC,OAAA,CAAAE,KAAA,OAAAC,SAAA;EAAA;EAAA,IAAAC,OAAA,GAAAL,cAAA,CAAAJ,SAAA;EAAAS,OAAA,CACzBC,MAAM,GAAN,SAAAA,OAAA,EAAiB;IACf,MAAM,IAAIP,KAAK,CAAC,8BAA8B,CAAC;EACjD,CAAC;EAAAM,OAAA,CAEDR,MAAM,GAAN,SAAAA,OAAOC,GAAY,EAAc;IAC/B,IAAIX,KAAK,GAAG,IAAI,CAACmB,MAAM,CAAC,CAAC;IACzB,OAAOnB,KAAK,CAACU,MAAM,CAACC,GAAG,CAAC;EAC1B,CAAC;EAAA,OAAAE,cAAA;AAAA,EARiCN,MAAM,E;;ACrB1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGgC;AACG;AAI5B,IAAMa,sBAAU;EAOrB,SAAAA,WACExB,GAAW,EACXyB,EAAU,EACVC,UAAuB,EACvBC,QAAyB,EACzB;IAAA,KAXF3B,GAAG;IAAA,KACHyB,EAAE;IAAA,KACFC,UAAU;IAAA,KACVC,QAAQ;IASN,IAAI,CAAC3B,GAAG,GAAGA,GAAG;IACd,IAAI,CAACyB,EAAE,GAAGA,EAAE;IACZ,IAAI,CAACC,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACC,QAAQ,GAAGA,QAAQ,IAAI,EAAE;EAChC;EAAC,IAAAf,MAAA,GAAAY,UAAA,CAAAX,SAAA;EAAAD,MAAA,CAEDE,MAAM,GAAN,SAAAA,OAAA,EAA0B;IACxB,MAAMc,gBAAgB,GAAG,CAAC,IAAI,CAACD,QAAQ,IAAI,EAAE,EAAEE,OAAO,CAACzB,KAAK,IAC1DA,KAAK,CAACU,MAAM,CAAC,CACf,CAAC;IACD,OAAO,CAAC,CAAC,IAAI,CAACW,EAAE,EAAE,IAAI,CAACC,UAAU,CAAC,CAAC,CAACI,MAAM,CAACF,gBAAgB,CAAC;EAC9D,CAAC;EAAAJ,UAAA,CAEMO,MAAM,GAAb,SAAAA,OACEhB,GAAY,EACZW,UAAuB,EACvBC,QAAyB,EACb;IACZ,OAAO,IAAIH,UAAU,CACnBT,GAAG,CAACf,GAAG,EACPwB,UAAU,CAACQ,SAAS,EAAE,EACtBN,UAAU,EACVC,QACF,CAAC;EACH,CAAC;EAAAH,UAAA,CAEMtB,cAAc,GAArB,SAAAA,eAAsBa,GAAY,EAAEX,KAAa,EAAc;IAC7D,MAAM6B,QAAQ,GAAGlC,OAAO,CAACG,cAAc,CAACa,GAAG,EAAEX,KAAK,CAAC;IACnD,OAAOA,KAAK,CAACU,MAAM,CAACmB,QAAQ,CAAC;EAC/B,CAAC;EAAA,OAAAT,UAAA;AAAA;AA1CUA,sBAAU,CAKdQ,SAAS,GAAW,CAAC,C;;;;ACrB9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGmD;AACP;AACT;AAE5B,IAAME,cAAM,0BAAAhB,OAAA;EAAAC,qBAAA,CAAAe,MAAA,EAAAhB,OAAA;EAGjB,SAAAgB,OAAYC,GAAW,EAAE;IAAA,IAAAC,KAAA;IACvBA,KAAA,GAAAlB,OAAA,CAAAmB,IAAA,KAAM,CAAC;IAACD,KAAA,CAHVD,GAAG;IAIDC,KAAA,CAAKD,GAAG,GAAGA,GAAG;IAAC,OAAAC,KAAA;EACjB;EAAC,IAAAxB,MAAA,GAAAsB,MAAA,CAAArB,SAAA;EAAAD,MAAA,CAEDE,MAAM,GAAN,SAAAA,OAAOC,GAAY,EAAc;IAC/B,MAAMuB,SAA0B,GAAG;MAACC,CAAC,EAAE,IAAI,CAACJ;IAAG,CAAC;IAChD,OAAOX,sBAAU,CAACO,MAAM,CAAChB,GAAG,EAAE,CAACuB,SAAS,CAAC,EAAE,IAAI,CAAC;EAClD,CAAC;EAAA,OAAAJ,MAAA;AAAA,EAXyBvB,MAAM;AAc3B,IAAM6B,eAAO,0BAAAC,QAAA;EAAAtB,qBAAA,CAAAqB,OAAA,EAAAC,QAAA;EAGlB,SAAAD,QAAYL,GAAW,EAAE;IAAA,IAAAO,MAAA;IACvBA,MAAA,GAAAD,QAAA,CAAAJ,IAAA,KAAM,CAAC;IAACK,MAAA,CAHVP,GAAG;IAIDO,MAAA,CAAKP,GAAG,GAAGA,GAAG;IAAC,OAAAO,MAAA;EACjB;EAAC,IAAApB,OAAA,GAAAkB,OAAA,CAAA3B,SAAA;EAAAS,OAAA,CAEDR,MAAM,GAAN,SAAAA,OAAOC,GAAY,EAAc;IAC/B,MAAMuB,SAA0B,GAAG;MAACC,CAAC,EAAE,IAAI,CAACJ;IAAG,CAAC;IAChD,OAAOX,sBAAU,CAACO,MAAM,CAAChB,GAAG,EAAE,CAACuB,SAAS,CAAC,EAAE,IAAI,CAAC;EAClD,CAAC;EAAA,OAAAE,OAAA;AAAA,EAX0B7B,MAAM;AAc5B,IAAMgC,YAAI,0BAAAC,QAAA;EAAAzB,qBAAA,CAAAwB,IAAA,EAAAC,QAAA;EAGf,SAAAD,KAAYE,IAAY,EAAE;IAAA,IAAAC,MAAA;IACxBA,MAAA,GAAAF,QAAA,CAAAP,IAAA,KAAM,CAAC;IAACS,MAAA,CAHVD,IAAI;IAIFC,MAAA,CAAKD,IAAI,GAAGA,IAAI;IAAC,OAAAC,MAAA;EACnB;EAAC,IAAAC,OAAA,GAAAJ,IAAA,CAAA9B,SAAA;EAAAkC,OAAA,CAEDjC,MAAM,GAAN,SAAAA,OAAOC,GAAY,EAAc;IAC/B,MAAMuB,SAA0B,GAAG;MAACC,CAAC,EAAE,IAAI,CAACM;IAAI,CAAC;IACjD,OAAOrB,sBAAU,CAACO,MAAM,CAAChB,GAAG,EAAE,CAACuB,SAAS,CAAC,EAAE,IAAI,CAAC;EAClD,CAAC;EAAA,OAAAK,IAAA;AAAA,EAXuBhC,MAAM;AAczB,IAAMqC,iBAAS,0BAAAC,QAAA;EAAA9B,qBAAA,CAAA6B,SAAA,EAAAC,QAAA;EAGpB,SAAAD,UAAYrB,QAAkB,EAAE;IAAA,IAAAuB,MAAA;IAC9BA,MAAA,GAAAD,QAAA,CAAAZ,IAAA,KAAM,CAAC;IAACa,MAAA,CAHVvB,QAAQ;IAINuB,MAAA,CAAKvB,QAAQ,GAAGA,QAAQ;IAAC,OAAAuB,MAAA;EAC3B;EAAC,IAAAC,OAAA,GAAAH,SAAA,CAAAnC,SAAA;EAAAsC,OAAA,CAEDrC,MAAM,GAAN,SAAAA,OAAOC,GAAY,EAAc;IAC/B,MAAMuB,SAA0B,GAAG;MAACC,CAAC,EAAE;IAAE,CAAC;IAC1C,MAAMZ,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACyB,GAAG,CAAChD,KAAK,IACtCoB,sBAAU,CAACtB,cAAc,CAACa,GAAG,EAAEX,KAAK,CACtC,CAAC;IACD,OAAOoB,sBAAU,CAACO,MAAM,CAAChB,GAAG,EAAE,CAACuB,SAAS,CAAC,EAAEX,QAAQ,CAAC;EACtD,CAAC;EAAA,OAAAqB,SAAA;AAAA,EAd4BrC,MAAM,E;;ACzDrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO,MAAM0C,WAAqB,GAAG,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC;AAClE,MAAMC,WAAqB,GAAGD,WAAW,CAACE,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAACzB,MAAM,CAAC,CAClE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,CAC5E,CAAC;AACK,MAAM0B,YAAsB,GAAG,CACpC,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,CACb;AACM,MAAMC,YAAsB,GAAGD,YAAY,CAACD,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAACzB,MAAM,CAAC,CACpE,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,CACb,CAAC,C;;;;AC/CF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEmD;AACW;AAC3B;AAMP;AAAA,IAOtB4B,uBAAc,0BAAAC,eAAA;EAAAxC,sBAAA,CAAAuC,cAAA,EAAAC,eAAA;EAGlB,SAAAD,eAAYE,IAAgB,EAAE;IAAA,IAAAxB,KAAA;IAC5BA,KAAA,GAAAuB,eAAA,CAAAtB,IAAA,KAAM,CAAC;IAACD,KAAA,CAHVwB,IAAI;IAIFxB,KAAA,CAAKwB,IAAI,GAAGA,IAAI;IAAC,OAAAxB,KAAA;EACnB;EAAC,IAAAxB,MAAA,GAAA8C,cAAA,CAAA7C,SAAA;EAAAD,MAAA,CAEDW,MAAM,GAAN,SAAAA,OAAA,EAAiB;IACf,MAAMI,QAAQ,GAAG,CACf,IAAIO,cAAM,CAAC,IAAI,CAAC0B,IAAI,CAACC,UAAU,CAAC,EAChC,IAAIlB,YAAI,CAAC,IAAI,CAACiB,IAAI,CAACE,SAAS,CAAC,EAC7B,IAAItB,eAAO,CAACuB,IAAI,CAACC,IAAI,CAAC,IAAI,CAACJ,IAAI,CAACC,UAAU,CAAC,CAAC,CAC7C;IAED,OAAO,IAAIb,iBAAS,CAACrB,QAAQ,CAAC;EAChC,CAAC;EAAA,OAAA+B,cAAA;AAAA,EAhB0BzC,cAAc;AAmBpC,IAAMgD,gBAAO,0BAAAC,gBAAA;EAAA/C,sBAAA,CAAA8C,OAAA,EAAAC,gBAAA;EAGlB,SAAAD,QAAYE,WAAoB,EAAE;IAAA,IAAAzB,MAAA;IAChCA,MAAA,GAAAwB,gBAAA,CAAA7B,IAAA,KAAM,CAAC;IAACK,MAAA,CAHVyB,WAAW;IAITzB,MAAA,CAAKyB,WAAW,GAAGA,WAAW;IAAC,OAAAzB,MAAA;EACjC;EAAC,IAAApB,OAAA,GAAA2C,OAAA,CAAApD,SAAA;EAAAS,OAAA,CAED8C,UAAU,GAAV,SAAAA,WAAWC,KAAe,EAAEC,MAAgB,EAAY;IACtD,IAAID,KAAK,CAACE,MAAM,IAAID,MAAM,CAACC,MAAM,EAAE;MACjC,MAAM,IAAIvD,KAAK,CAAC,wCAAwC,CAAC;IAC3D;IACA,OAAOsD,MAAM,CAAClB,GAAG,CAAC,CAACU,SAAS,EAAEU,KAAK,KAAK;MACtC,MAAMX,UAAU,GAAGQ,KAAK,CAACG,KAAK,CAAC;MAC/B,MAAMC,MAAM,GAAG,IAAIf,uBAAc,CAAC;QAChCI,SAAS,EAAEA,SAAS;QACpBD,UAAU,EAAEA;MACd,CAAC,CAAC;MACFY,MAAM,CAACzE,GAAG,GAAI,GAAE8D,SAAU,IAAGD,UAAW,EAAC;MACzC,OAAOY,MAAM;IACf,CAAC,CAAC;EACJ,CAAC;EAAAnD,OAAA,CAEDoD,WAAW,GAAX,SAAAA,YAAA,EAAwB;IACtB,IAAI,IAAI,CAACP,WAAW,EAAE;MACpB,OAAO,IAAI,CAACC,UAAU,CAACd,WAAW,EAAEG,YAAY,CAAC;IACnD;IACA,OAAO,IAAI,CAACW,UAAU,CAACf,WAAW,EAAEG,YAAY,CAAC;EACnD,CAAC;EAAAlC,OAAA,CAEDC,MAAM,GAAN,SAAAA,OAAA,EAAiB;IACf,MAAMI,QAAQ,GAAG,IAAI,CAAC+C,WAAW,CAAC,CAAC;IACnC,OAAO,IAAI1B,iBAAS,CAACrB,QAAQ,CAAC;EAChC,CAAC;EAAA,OAAAsC,OAAA;AAAA,EAjC0BhD,cAAc,E;;AC5C3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAE4C;AAEN;AACH;AAWnC,SAAS0D,mBAAmBA,CAC1BC,OAAmB,EACnBC,OAAmB,EACP;EACZ,OAAO,IAAIrD,sBAAU,CACnBoD,OAAO,CAAC5E,GAAG,EACX6E,OAAO,CAACpD,EAAE,EACVmD,OAAO,CAAClD,UAAU,EAClBoD,iBAAiB,CAACF,OAAO,CAACjD,QAAQ,EAAEkD,OAAO,CAAClD,QAAQ,CACtD,CAAC;AACH;AAEA,SAASmD,iBAAiBA,CACxBC,WAAyB,EACzBC,WAAyB,EACX;EACd,MAAMC,WAAyB,GAAG,EAAE;EACpC,MAAMC,gBAAyC,GAAG,IAAIC,GAAG,CAAC,CAAC;EAC3DH,WAAW,CAACI,OAAO,CAAChF,KAAK,IAAI8E,gBAAgB,CAACG,GAAG,CAACjF,KAAK,CAACJ,GAAG,EAAEI,KAAK,CAAC,CAAC;EAEpE2E,WAAW,CAACK,OAAO,CAAChF,KAAK,IAAI;IAC3B,MAAMM,MAAM,GAAGN,KAAK,CAACJ,GAAG;IACxB,MAAMsF,QAAQ,GAAGJ,gBAAgB,CAACK,GAAG,CAAC7E,MAAM,CAAC;IAC7C,IAAI4E,QAAQ,KAAK/E,SAAS,EAAE;MAC1B0E,WAAW,CAACO,IAAI,CAACb,mBAAmB,CAACvE,KAAK,EAAEkF,QAAQ,CAAC,CAAC;IACxD,CAAC,MAAM;MACLL,WAAW,CAACO,IAAI,CAACpF,KAAK,CAAC;IACzB;EACF,CAAC,CAAC;EAEF,OAAO6E,WAAW;AACpB;AAEA,SAASQ,uBAAuBA,CAC9BC,QAAyB,EACC;EAC1B,MAAMtC,GAA6B,GAAG,IAAI+B,GAAG,CAAC,CAAC;EAC/CO,QAAQ,CAACN,OAAO,CAACO,MAAM,IAAI;IACzB,MAAM3F,GAAG,GAAG2F,MAAM,CAAC,CAAC,CAAC;IACrB,MAAMC,KAAK,GAAGD,MAAM,CAAC,CAAC,CAAC;IACvB,IAAIvC,GAAG,CAACmC,GAAG,CAACvF,GAAG,CAAC,IAAIO,SAAS,EAAE;MAC7B6C,GAAG,CAACiC,GAAG,CAACrF,GAAG,EAAE,EAAE,CAAC;IAClB;IAEA,MAAM0B,UAAU,GAAG0B,GAAG,CAACmC,GAAG,CAACvF,GAAG,CAAC;IAC/B,IAAI0B,UAAU,KAAKnB,SAAS,EAAE;MAC5BmB,UAAU,CAAC8D,IAAI,CAAC,GAAGI,KAAK,CAAC;IAC3B,CAAC,MAAM;MACL,MAAM,IAAI5E,KAAK,CAAC,kCAAkC,CAAC;IACrD;EACF,CAAC,CAAC;EAEF,OAAOoC,GAAG;AACZ;AAEA,SAASyC,SAASA,CAChBC,WAA4B,EAC5BC,WAA4B,EACjB;EACX,MAAMC,iBAAkC,GAAG,EAAE;EAC7C,MAAMC,iBAAkC,GAAG,EAAE;EAE7C,MAAMC,YAAY,GAAGH,WAAW,CAAC3C,GAAG,CAACuC,MAAM,IAAIA,MAAM,CAAC,CAAC,CAAC,CAAC;EACzD,MAAMQ,YAAY,GAAGL,WAAW,CAAC1C,GAAG,CAACuC,MAAM,IAAIA,MAAM,CAAC,CAAC,CAAC,CAAC;EAEzD,MAAMS,eAAe,GAAGD,YAAY,CAACE,MAAM,CACzCC,QAAQ,IAAI,CAACJ,YAAY,CAACK,QAAQ,CAACD,QAAQ,CAC7C,CAAC;EACD,MAAME,eAAe,GAAGN,YAAY,CAACG,MAAM,CACzCC,QAAQ,IAAI,CAACH,YAAY,CAACI,QAAQ,CAACD,QAAQ,CAC7C,CAAC;EAED,MAAMG,aAAa,GAAGhB,uBAAuB,CAACM,WAAW,CAAC;EAC1D,MAAMW,aAAa,GAAGjB,uBAAuB,CAACK,WAAW,CAAC;EAE1DM,eAAe,CAAChB,OAAO,CAACkB,QAAQ,IAAI;IAClC,MAAM5E,UAAU,GAAG,CAACgF,aAAa,CAACnB,GAAG,CAACe,QAAQ,CAAC,IAAI,EAAE,EAAElD,GAAG,CAACuD,EAAE,IAAI,CAC/DL,QAAQ,EACRK,EAAE,CACH,CAAC;IACFX,iBAAiB,CAACR,IAAI,CAAC,GAAG9D,UAAU,CAAC;EACvC,CAAC,CAAC;EAEFgF,aAAa,CAACtB,OAAO,CAAC,CAACQ,KAAK,EAAE5F,GAAG,KAAK;IACpC,IAAIyG,aAAa,CAAClB,GAAG,CAACvF,GAAG,CAAC,IAAIO,SAAS,EAAE;MACvC;IACF;IAEA,MAAMqG,mBAAmB,GAAGH,aAAa,CAAClB,GAAG,CAACvF,GAAG,CAAC,IAAI,EAAE;IACxD,MAAM6G,mBAAmB,GAAGjB,KAAK;IAEjC,MAAMkB,OAAO,GAAGF,mBAAmB,CAACP,MAAM,CACxCM,EAAE,IAAI,CAACE,mBAAmB,CAACN,QAAQ,CAACI,EAAE,CACxC,CAAC;IACD,MAAMI,OAAO,GAAGF,mBAAmB,CAACR,MAAM,CACxCM,EAAE,IAAI,CAACC,mBAAmB,CAACL,QAAQ,CAACI,EAAE,CACxC,CAAC;IAEDG,OAAO,CAAC1B,OAAO,CAACuB,EAAE,IAAIV,iBAAiB,CAACT,IAAI,CAAC,CAACxF,GAAG,EAAE2G,EAAE,CAAC,CAAC,CAAC;IACxDI,OAAO,CAAC3B,OAAO,CAACuB,EAAE,IAAIX,iBAAiB,CAACR,IAAI,CAAC,CAACxF,GAAG,EAAE2G,EAAE,CAAC,CAAC,CAAC;EAC1D,CAAC,CAAC;EAEF,OAAO;IACLP,eAAe,EAAEA,eAAe;IAChCI,eAAe,EAAEA,eAAe;IAChCR,iBAAiB,EAAEA,iBAAiB;IACpCC,iBAAiB,EAAEA;EACrB,CAAC;AACH;AAEO,SAASe,OAAOA,CAACC,wBAAiC,EAAc;EACrE;EACA,MAAMC,MAAM,GAAG,IAAInH,OAAO,CAAC,MAAM,CAAC;EAClC,MAAMoH,aAAa,GAAG,IAAIlD,gBAAO,CAAC,KAAK,CAAC,CAAC1C,MAAM,CAAC,CAAC;EACjD,MAAM6F,aAAa,GAAGD,aAAa,CAACrG,MAAM,CAACoG,MAAM,CAAC;EAClD,MAAMG,aAAa,GAAGD,aAAa,CAACtG,MAAM,CAAC,CAAC;;EAE5C;EACA,MAAMwG,MAAM,GAAG,IAAIvH,OAAO,CAAC,MAAM,CAAC;EAClC,MAAMwH,aAAa,GAAG,IAAItD,gBAAO,CAAC,IAAI,CAAC,CAAC1C,MAAM,CAAC,CAAC;EAChD,MAAMiG,aAAa,GAAGD,aAAa,CAACzG,MAAM,CAACwG,MAAM,CAAC;EAElD,MAAMG,oBAAoB,GAAG9C,mBAAmB,CAC9C6C,aAAa,EACbJ,aACF,CAAC;EACD,MAAMM,oBAAoB,GAAGD,oBAAoB,CAAC3G,MAAM,CAAC,CAAC;EAC1D,MAAM6G,IAAI,GAAG9B,SAAS,CAAC6B,oBAAoB,EAAEL,aAAa,CAAC;EAC3D,OAAOJ,wBAAwB,GAAGU,IAAI,GAAG,IAAI;AAC/C,C;;ACzJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEwC;AAExCC,UAAU,CAACC,WAAW,GAAGb,OAAO,C;;ACZhC;AACA;AACA;AACA;AACA;AACA;;AAEoB;AAEpB,MAAMc,SAAS,GAAG,KAAK;AAEvB,IAAIA,SAAS,EAAE;EACXC,KAAK,CAACC,IAAI,CAACC,SAAS,CAACJ,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;AAC5C,CAAC,MAAM;EACHE,KAAK,CAAC,YAAY,CAAC;EACnB;EACA,IAAIG,CAAS;EACb,KAAIA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAE,EAAEA,CAAC,EACpBL,WAAW,CAAC,KAAK,CAAC;EACpB;EACA,IAAIM,EAAE,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;EACnB,KAAIH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,EAAE,EAAEA,CAAC,EACtBL,WAAW,CAAC,KAAK,CAAC;EACpBE,KAAK,CAACK,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGF,EAAE,EAAE,IAAI,EAAED,CAAC,EAAE,YAAY,CAAC;AACjD,C","file":"widgets.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport {Widget} from './widget';\n\nexport default class Context {\n  key: string;\n  childCounter: number;\n\n  constructor(key: string) {\n    this.key = key;\n    this.childCounter = 0;\n  }\n\n  static createForChild(parentCtx: Context, child: Widget): Context {\n    const widgetKey = child.key;\n    const childKey =\n      widgetKey !== null && widgetKey !== undefined\n        ? widgetKey\n        : `${child.constructor.name}_${parentCtx.childCounter++}`;\n    const newKey = `${parentCtx.key}_${childKey}`;\n    return new Context(newKey);\n  }\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n * @format\n */\n\nimport type {RenderNode} from './render_node.js';\nimport Context from './context.js';\n\nexport class Widget {\n  key: ?string;\n\n  reduce(ctx: Context): RenderNode {\n    throw new Error('Implement this in a subclass');\n  }\n}\n\nexport class ComposedWidget extends Widget {\n  render(): Widget {\n    throw new Error('Implement this in a subclass');\n  }\n\n  reduce(ctx: Context): RenderNode {\n    let child = this.render();\n    return child.reduce(ctx);\n  }\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport type {Component} from './components.js';\nimport {Widget} from './widget';\nimport Context from './context.js';\n\nexport type VirtualEntity = [number, Component[]];\n\nexport class RenderNode {\n  key: string;\n  id: number;\n  components: Component[];\n  children: RenderNode[];\n  static idCounter: number = 0;\n\n  constructor(\n    key: string,\n    id: number,\n    components: Component[],\n    children: ?(RenderNode[]),\n  ) {\n    this.key = key;\n    this.id = id;\n    this.components = components;\n    this.children = children || [];\n  }\n\n  reduce(): VirtualEntity[] {\n    const childrenEntities = (this.children || []).flatMap(child =>\n      child.reduce(),\n    );\n    return [[this.id, this.components]].concat(childrenEntities);\n  }\n\n  static create(\n    ctx: Context,\n    components: Component[],\n    children: ?(RenderNode[]),\n  ): RenderNode {\n    return new RenderNode(\n      ctx.key,\n      RenderNode.idCounter++,\n      components,\n      children,\n    );\n  }\n\n  static createForChild(ctx: Context, child: Widget): RenderNode {\n    const childCtx = Context.createForChild(ctx, child);\n    return child.reduce(childCtx);\n  }\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport type {NumberComponent, StringComponent} from './components.js';\nimport {Widget, ComposedWidget} from './widget.js';\nimport {RenderNode} from './render_node.js';\nimport Context from './context.js';\n\nexport class Button extends Widget {\n  num: number;\n\n  constructor(num: number) {\n    super();\n    this.num = num;\n  }\n\n  reduce(ctx: Context): RenderNode {\n    const component: NumberComponent = {x: this.num};\n    return RenderNode.create(ctx, [component], null);\n  }\n}\n\nexport class Floater extends Widget {\n  num: number;\n\n  constructor(num: number) {\n    super();\n    this.num = num;\n  }\n\n  reduce(ctx: Context): RenderNode {\n    const component: NumberComponent = {x: this.num};\n    return RenderNode.create(ctx, [component], null);\n  }\n}\n\nexport class Gltf extends Widget {\n  path: string;\n\n  constructor(path: string) {\n    super();\n    this.path = path;\n  }\n\n  reduce(ctx: Context): RenderNode {\n    const component: StringComponent = {x: this.path};\n    return RenderNode.create(ctx, [component], null);\n  }\n}\n\nexport class Container extends Widget {\n  children: Widget[];\n\n  constructor(children: Widget[]) {\n    super();\n    this.children = children;\n  }\n\n  reduce(ctx: Context): RenderNode {\n    const component: NumberComponent = {x: 13};\n    const children = this.children.map(child =>\n      RenderNode.createForChild(ctx, child),\n    );\n    return RenderNode.create(ctx, [component], children);\n  }\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nexport const SIZES_SMALL: number[] = [64, 8, 8, 18, 7, 24, 84, 4, 29, 58];\nexport const SIZES_LARGE: number[] = SIZES_SMALL.slice(0, 5).concat([\n  99, 9, 61, 27, 58, 30, 27, 95, 49, 37, 28, 87, 60, 95, 1, 58, 14, 90, 9, 57,\n]);\nexport const MODELS_SMALL: string[] = [\n  'sazGTSGrfY',\n  'uEQjieLDUq',\n  'jQKzwhnzYa',\n  'buIwVjnNDI',\n  'goBJPxAkFf',\n  'uKihCBaMwm',\n  'VAyeIqqnSU',\n  'bMNULcHsKb',\n  'NBMEpcDimq',\n  'wMCIoQQbNg',\n];\nexport const MODELS_LARGE: string[] = MODELS_SMALL.slice(0, 5).concat([\n  'oCtHzjLczM',\n  'GJVcmhfddz',\n  'nbpEAplbzQ',\n  'yNXDBUcDys',\n  'IZZQpqwiXa',\n  'AAroNFkOBf',\n  'flsXwiIaQG',\n  'qazjSVkFcR',\n  'PefkCqwfKJ',\n  'yJDvizIEDY',\n  'XauGblPeuo',\n  'ZnvLBVjEom',\n  'UeosvyfoBE',\n  'BFeZAIAHQq',\n  'iOYUWXWXhr',\n  'WpOfaJwOlm',\n  'sVHOxutIGB',\n  'qOikwyZSWx',\n  'KJGEPQxUKU',\n  'cqrRvLCCYB',\n]);\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport {Widget, ComposedWidget} from './widget.js';\nimport {Button, Container, Gltf, Floater} from './widgets.js';\nimport Context from './context.js';\nimport {\n  SIZES_SMALL,\n  SIZES_LARGE,\n  MODELS_SMALL,\n  MODELS_LARGE,\n} from './test_app_data.js';\n\ntype RenderData = {\n  modelPath: string,\n  buttonSize: number,\n};\n\nclass ButtonAndModel extends ComposedWidget {\n  data: RenderData;\n\n  constructor(data: RenderData) {\n    super();\n    this.data = data;\n  }\n\n  render(): Widget {\n    const children = [\n      new Button(this.data.buttonSize),\n      new Gltf(this.data.modelPath),\n      new Floater(Math.sqrt(this.data.buttonSize)),\n    ];\n\n    return new Container(children);\n  }\n}\n\nexport class TestApp extends ComposedWidget {\n  renderLarge: boolean;\n\n  constructor(renderLarge: boolean) {\n    super();\n    this.renderLarge = renderLarge;\n  }\n\n  getWidgets(sizes: number[], models: string[]): Widget[] {\n    if (sizes.length != models.length) {\n      throw new Error('sizes and models must have same length');\n    }\n    return models.map((modelPath, index) => {\n      const buttonSize = sizes[index];\n      const widget = new ButtonAndModel({\n        modelPath: modelPath,\n        buttonSize: buttonSize,\n      });\n      widget.key = `${modelPath}_${buttonSize}`;\n      return widget;\n    });\n  }\n\n  getChildren(): Widget[] {\n    if (this.renderLarge) {\n      return this.getWidgets(SIZES_LARGE, MODELS_LARGE);\n    }\n    return this.getWidgets(SIZES_SMALL, MODELS_SMALL);\n  }\n\n  render(): Widget {\n    const children = this.getChildren();\n    return new Container(children);\n  }\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport {RenderNode} from './render_node.js';\nimport type {VirtualEntity} from './render_node.js';\nimport {TestApp} from './test_app.js';\nimport Context from './context.js';\nimport type {Component} from './components.js';\n\ntype ComponentPair = [number, Component];\ntype SceneDiff = {\n  createdEntities: number[],\n  deletedEntities: number[],\n  createdComponents: ComponentPair[],\n  deletedComponents: ComponentPair[],\n};\n\nfunction reconcileRenderNode(\n  newNode: RenderNode,\n  oldNode: RenderNode,\n): RenderNode {\n  return new RenderNode(\n    newNode.key,\n    oldNode.id,\n    newNode.components,\n    reconcileChildren(newNode.children, oldNode.children),\n  );\n}\n\nfunction reconcileChildren(\n  newChildren: RenderNode[],\n  oldChildren: RenderNode[],\n): RenderNode[] {\n  const outChildren: RenderNode[] = [];\n  const oldChildrenByKey: Map<string, RenderNode> = new Map();\n  oldChildren.forEach(child => oldChildrenByKey.set(child.key, child));\n\n  newChildren.forEach(child => {\n    const newKey = child.key;\n    const oldChild = oldChildrenByKey.get(newKey);\n    if (oldChild !== undefined) {\n      outChildren.push(reconcileRenderNode(child, oldChild));\n    } else {\n      outChildren.push(child);\n    }\n  });\n\n  return outChildren;\n}\n\nfunction mapEntitiesToComponents(\n  entities: VirtualEntity[],\n): Map<number, Component[]> {\n  const map: Map<number, Component[]> = new Map();\n  entities.forEach(entity => {\n    const key = entity[0];\n    const value = entity[1];\n    if (map.get(key) == undefined) {\n      map.set(key, []);\n    }\n\n    const components = map.get(key);\n    if (components !== undefined) {\n      components.push(...value);\n    } else {\n      throw new Error('components shouldnt be undefined');\n    }\n  });\n\n  return map;\n}\n\nfunction diffTrees(\n  newEntities: VirtualEntity[],\n  oldEntities: VirtualEntity[],\n): SceneDiff {\n  const createdComponents: ComponentPair[] = [];\n  const deletedComponents: ComponentPair[] = [];\n\n  const oldEntityIds = oldEntities.map(entity => entity[0]);\n  const newEntityIds = newEntities.map(entity => entity[0]);\n\n  const createdEntities = newEntityIds.filter(\n    entityId => !oldEntityIds.includes(entityId),\n  );\n  const deletedEntities = oldEntityIds.filter(\n    entityId => !newEntityIds.includes(entityId),\n  );\n\n  const oldComponents = mapEntitiesToComponents(oldEntities);\n  const newComponents = mapEntitiesToComponents(newEntities);\n\n  createdEntities.forEach(entityId => {\n    const components = (newComponents.get(entityId) || []).map(it => [\n      entityId,\n      it,\n    ]);\n    createdComponents.push(...components);\n  });\n\n  newComponents.forEach((value, key) => {\n    if (oldComponents.get(key) == undefined) {\n      return;\n    }\n\n    const oldComponentsForKey = oldComponents.get(key) || [];\n    const newComponentsForKey = value;\n\n    const deleted = oldComponentsForKey.filter(\n      it => !newComponentsForKey.includes(it),\n    );\n    const created = newComponentsForKey.filter(\n      it => !oldComponentsForKey.includes(it),\n    );\n\n    deleted.forEach(it => deletedComponents.push([key, it]));\n    created.forEach(it => createdComponents.push([key, it]));\n  });\n\n  return {\n    createdEntities: createdEntities,\n    deletedEntities: deletedEntities,\n    createdComponents: createdComponents,\n    deletedComponents: deletedComponents,\n  };\n}\n\nexport function runTest(includeTreeSerialization: boolean): ?SceneDiff {\n  /* Render a tree with 10 widgets */\n  const oldCtx = new Context('root');\n  const oldWidgetTree = new TestApp(false).render();\n  const oldRenderTree = oldWidgetTree.reduce(oldCtx);\n  const oldEntityTree = oldRenderTree.reduce();\n\n  /* Render a tree with 25 widgets, the first 5 of which are the same */\n  const newCtx = new Context('root');\n  const newWidgetTree = new TestApp(true).render();\n  const newRenderTree = newWidgetTree.reduce(newCtx);\n\n  const reconciledRenderTree = reconcileRenderNode(\n    newRenderTree,\n    oldRenderTree,\n  );\n  const reconciledEntityTree = reconciledRenderTree.reduce();\n  const diff = diffTrees(reconciledEntityTree, oldEntityTree);\n  return includeTreeSerialization ? diff : null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport {runTest} from './app_runner.js';\n\nglobalThis.runFullTest = runTest;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport './index.js';\n\nconst printDiff = false;\n\nif (printDiff) {\n    print(JSON.stringify(runFullTest(true)));\n} else {\n    print(\"Running...\");\n    // Warmup.\n    var i: number;\n    for(i = 0; i < 50; ++i)\n      runFullTest(false);\n    // The actual execution.\n    let t1 = Date.now();\n    for(i = 0; i < 5000; ++i)\n      runFullTest(false);\n    print(Date.now() - t1, \"ms\", i, \"iterations\");\n}\n\n"],"sourceRoot":""}